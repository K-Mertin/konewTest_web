<div class="container">
  <div class="text-center">
    <h3>關係人資料建檔</h3>
  </div>
  <form [formGroup]="relationForm">
    <div class="form-group">
      <label>登錄原因：</label>
      <input type="text" placeholder="登錄原因" formControlName="reason">
      <div *ngIf="relationForm.controls['reason'].touched && relationForm.controls['reason'].invalid" class="alert alert-danger">
        請輸入登錄原因
      </div>
    </div>
    <label>登錄人員：</label>
    <input type="text" placeholder="建檔人員" formControlName="user">
    <div *ngIf="relationForm.controls['user'].touched && relationForm.controls['user'].invalid" class="alert alert-danger">
      請輸入建檔人員
    </div>


    <div formArrayName="subjects">
      <label>借款人：</label>
      <div *ngFor="let subject of relationForm.controls['subjects'].controls; let i=index">

        <span>負責人 {{i + 1}}</span>
        <span class="fa fa-times  pull-right" *ngIf="relationForm.controls['subjects'].controls.length > 1" (click)="remove(i,'subjects')">
        </span>
        <div class="form-group" [formGroupName]="i">
          <input type="text" placeholder="負責人/公司名" formControlName="name">
          <input type="text" placeholder="負責人/公司統編" formControlName="idNumber">
          <div *ngIf="(relationForm.controls['subjects'].controls[i].controls.idNumber.touched||relationForm.controls['subjects'].controls[i].controls.name.touched) && relationForm.controls['subjects'].controls[i].hasError('checkValidate')"
            class="alert alert-danger">
            姓名與統編須擇一輸入
          </div>
        </div>
      </div>
      <div class="margin-20">
        <a (click)="addSubject()" style="cursor: default">
          添加負責人 +
        </a>
      </div>
    </div>




    <div formArrayName="objects">
      <label>關係人：</label>
      <div *ngFor="let object of relationForm.controls['objects'].controls; let i=index">

        <span>關係人/公司 {{i + 1}}</span>
        <span class="fa fa-times  pull-right" *ngIf="relationForm.controls['objects'].controls.length > 1" (click)="remove(i,'objects')">
        </span>

        <div class="form-group" [formGroupName]="i">
          <input type="text" placeholder="關係人/公司名" formControlName="name">
          <input type="text" placeholder="關係人/公司統編" formControlName="idNumber">
          <input type="text" placeholder="關係種類" formControlName="relationType">
          <div *ngIf="(relationForm.controls['objects'].controls[i].controls.idNumber.touched||relationForm.controls['objects'].controls[i].controls.name.touched) && relationForm.controls['objects'].controls[i].hasError('checkValidate')"
            class="alert alert-danger">
            姓名與統編須擇一輸入
          </div>
          <div *ngIf="relationForm.controls['objects'].controls[i].controls.relationType.touched && relationForm.controls['objects'].controls[i].controls.relationType.invalid"
            class="alert alert-danger">
            請輸入關係種類
          </div>
        </div>
      </div>
      <div class="margin-20">
        <a (click)="addObject()" style="cursor: default">
          添加新關係 +
        </a>
      </div>
    </div>
  </form>
  <div class="button pull-right">
    <button class="btn btn-danger" *ngIf="relationForm.touched" (click)="clearForm()">清除</button>
    <button class="btn btn-primary" *ngIf="!relationForm.invalid" (click)="insertRelation()">新增</button>
  </div>
</div>